<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h3>Select from all the users to make connection with</h3>
    <div id="contacts-list">

    </div>
</body>
<script>
    const contactsList = document.getElementById("contacts-list");
      contactsList.innerHTML = "";
  // Retrieve contacts from your data source
  fetch(`http://localhost:7890/chat/`,{
        method:'GET',
        headers:{'Content-type':'Application/json',"authorization":`bearer ${JSON.parse(localStorage.getItem('token'))}`,"refresh":`bearer ${JSON.parse(localStorage.getItem("refreshToken"))}`},
    }).then((res)=>res.json()).then((res)=>{
        console.log(res);
        res.forEach((ele)=>{
            contactsList.innerHTML += `<li onClick="addCon('${ele._id}','${ele.avtar}','${ele.name}')">${ele.name}</li>`
        })
    }).catch((err)=>console.log(err)) 

function addCon(id,tar,name){
    console.log("ok");
    fetch(`http://localhost:7890/chat/addCon`,{
        method:'POST',
        headers:{'Content-type':'Application/json',"authorization":`bearer ${JSON.parse(localStorage.getItem('token'))}`,"refresh":`bearer ${JSON.parse(localStorage.getItem("refreshToken"))}`},
        body:JSON.stringify({frendId:id,frendAvtar:tar,frendName:name,id:JSON.parse(localStorage.getItem("selfObjectId")),myAvtar:JSON.parse(localStorage.getItem("myAvtar")),myName:JSON.parse(localStorage.getItem("myName"))})
        //,
    }).then((res)=>res.json()).then((res)=>{
        console.log(res);
        //window.location.href="./chatpage.html"
    }).catch((err)=>console.log(err))
    
}
</script>
</html>